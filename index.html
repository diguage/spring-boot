<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta content="Asciidoctor 2.0.23" name="generator">
<meta content="D瓜哥" name="author">
<title>Spring Boot 源码分析Alpha</title>
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700" rel="stylesheet">
<link href="css/asciidoctor.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="css/rouge-github.css" rel="stylesheet">
</head>
<body class="toc2 book toc-left">
<div id="header">
<h1>Spring Boot 源码分析<sup>Alpha</sup></h1>
<div class="details">
<span class="author" id="author">D瓜哥</span><br>
<span class="email" id="email"><a href="https://www.diguage.com" class="bare">https://www.diguage.com</a></span><br>
<span id="revnumber">version 3.5.0-SNAPSHOT</span>
</div>
<div class="toc2" id="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#前言">前言</a>
<ul class="sectlevel2">
<li><a href="#友情支持">友情支持</a></li>
<li><a href="#官网及版本库">官网及版本库</a></li>
</ul>
</li>
<li><a href="#spring-boot-重点">1. Spring Boot 重点</a></li>
<li><a href="#启动流程">2. 启动流程</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="前言"><a href="#前言" class="anchor"></a>前言</h2>
<div class="sectionbody">
<div class="paragraph">
<p>本文档是 D瓜哥 阅读 Spring Boot 源码以及相关文档时的笔记。对学习内容做一些总结和提炼，分享出来也方便大家一起学习，共同进步。</p>
</div>
<div class="sect2">
<h3 id="友情支持"><a href="#友情支持" class="anchor"></a>友情支持</h3>
<div class="paragraph">
<p>如果您觉得这个笔记对您有所帮助，看在D瓜哥码字的辛苦上，请友情支持一下，D瓜哥感激不尽，😜</p>
</div>
<table class="tableblock frame-none grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img alt="支付宝" src="images/alipay.png" width="95%" title="支付宝"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img alt="微信" src="images/wxpay.png" width="95%" title="微信"></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>有些打赏的朋友希望可以加个好友，欢迎关注D瓜哥的微信公众号，这样就可以通过公众号的回复直接给我发信息。</p>
</div>
<div class="paragraph">
<p><span class="image"><img alt="wx jikerizhi" src="images/wx-jikerizhi.png" width="98%"></span></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<strong>公众号的微信号是: jikerizhi （“极客日志”全拼）</strong>。<em>因为众所周知的原因，有时图片加载不出来。如果图片加载不出来可以直接通过搜索微信号来查找我的公众号。</em>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="官网及版本库"><a href="#官网及版本库" class="anchor"></a>官网及版本库</h3>
<div class="paragraph">
<p>本文档的版本库托管在 Github 上，另外单独发布。</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">“地瓜哥”博客网</dt>
<dd>
<p><a href="https://www.diguage.com/" class="bare" rel="noopener" target="_blank">https://www.diguage.com/</a> 。D瓜哥的个人博客。欢迎光临，不过，内容很杂乱，请见谅。不见谅，你来打我啊，😂😂</p>
</dd>
<dt class="hdlist1">本文档官网</dt>
<dd>
<p><a href="https://diguage.github.io/spring-boot/" class="bare" rel="noopener" target="_blank">https://diguage.github.io/spring-boot/</a> 。为了方便阅读，这里展示了处理好的文档。阅读请点击这个网址。</p>
</dd>
<dt class="hdlist1">本文档版本库</dt>
<dd>
<p><a href="https://github.com/diguage/spring-boot" class="bare" rel="noopener" target="_blank">https://github.com/diguage/spring-boot</a> 。由于组织方式的特殊性，坦白讲，不建议大家发 PR。有问题，欢迎发 Issue 讨论。</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-boot-重点"><a href="#spring-boot-重点" class="anchor"></a>1. Spring Boot 重点</h2>
<div class="sectionbody">
<div class="arabic olist">
<ol class="arabic">
<li>
<p>零配置</p>
</li>
<li>
<p>启动流程。重点利用了 Spring 的 <code>ApplicationEvent</code> 订阅/发布模式。</p>
</li>
<li>
<p>自动配置</p>
</li>
<li>
<p>运维</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="启动流程"><a href="#启动流程" class="anchor"></a>2. 启动流程</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap rouge"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="gl linenos"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">com.diguage.truman</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.boot.CommandLineRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.context.properties.EnableConfigurationProperties</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="cm">/**
 * Truman 应用
 *
 * @author D瓜哥 · https://www.diguage.com
 * @since 2021-08-04 08:50:57
 */</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableConfigurationProperties</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TrumanApplication</span> <span class="kd">implements</span> <span class="nc">CommandLineRunner</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">TrumanApplication</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">TrumanApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="nc">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Start……"</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img alt="Diagram" src="SpringApplication-run.svg" width="98%" height="4112">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap rouge"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="gl linenos"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">com.diguage.truman</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.extension.ExtendWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.bean.override.mockito.MockitoBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit.jupiter.SpringExtension</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">assertj</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">Assertions</span><span class="o">.</span><span class="na">assertThat</span><span class="o">;</span>

<span class="cm">/**
 * MockBean 测试
 *
 * @author D瓜哥 · https://www.diguage.com
 * @since 2021-08-04 08:50:57
 */</span>
<span class="nd">@Slf4j</span>
<span class="nd">@SpringBootTest</span><span class="o">(</span><span class="n">classes</span> <span class="o">=</span> <span class="nc">TrumanApplication</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">SpringExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MockBeanTest</span> <span class="o">{</span>

	<span class="nd">@MockitoBean</span>
	<span class="kd">private</span> <span class="nc">Runnable</span> <span class="n">run</span><span class="o">;</span>

	<span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">assertThat</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">run</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
		<span class="n">assertThat</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">run</span><span class="o">).</span><span class="na">isInstanceOf</span><span class="o">(</span><span class="nc">Runnable</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="c1">// org.mockito.codegen.Runnable$MockitoMock$XXXXX</span>
		<span class="c1">// 从这里可以看出，MockBean 是由 Mockito 创建的 Mock。</span>
		<span class="c1">// 底层是 Byte Buddy 利用字节码编辑技术动态生成的类。</span>
		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"class={}"</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">run</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
	<span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.5.0-SNAPSHOT<br>
Last updated 2025-03-03 12:03:59 UTC
</div>
</div>
</body>
</html>